targets=(
  "centos"
  "ubuntu"
)
pkgname="carbonio-grafana-settings"
pkgver="0.1"
pkgrel="1"
pkgdesc="Grafana settings and dashboards to display Carbonio Stats"
pkgdesclong=(
  "Grafana settings and dashboards to display Carbonio Stats"
)
maintainer="Zextras <packages@zextras.com>"
url="https://zextras.com"
section="mail"
priority="optional"
arch="amd64"
sources=(
  "carbonio-dashboards.yml"
  "carbonio-directory.json"
  "carbonio-docs.json"
  "carbonio-mailstore-protocols.json"
  "carbonio-mailstore-details.json"
  "carbonio-mariadb.json"
  "carbonio-node.json"
  "carbonio-postfix.json"
  "carbonio-process.json"
  "carbonio-prometheus.yml"
  "carbonio.json"
  "grafana.ini"
)
hashsums=(
  "skip"
  "skip"
  "skip"
  "skip"
  "skip"
  "skip"
  "skip"
  "skip"
  "skip"
  "skip"
  "skip"
  "skip"
)

depends=(
  "grafana"
)

package() {
  install -Dm644 "${srcdir}"/carbonio-prometheus.yml \
    "${pkgdir}"/etc/grafana/provisioning/datasources/carbonio-prometheus.yml
  install -Dm644 "${srcdir}"/carbonio-dashboards.yml \
    "${pkgdir}"/etc/grafana/provisioning/dashboards/carbonio-dashboards.yml
  install -Dm644 "${srcdir}"/carbonio-directory.json \
    "${pkgdir}"/etc/grafana/provisioning/dashboards/carbonio-directory.json
  install -Dm644 "${srcdir}"/carbonio-docs.json \
    "${pkgdir}"/etc/grafana/provisioning/dashboards/carbonio-docs.json
  install -Dm644 "${srcdir}"/carbonio-mailstore-protocols.json \
    "${pkgdir}"/etc/grafana/provisioning/dashboards/carbonio-mailstore-protocols.json
  install -Dm644 "${srcdir}"/carbonio-mailstore-details.json \
    "${pkgdir}"/etc/grafana/provisioning/dashboards/carbonio-mailstore-details.json
  install -Dm644 "${srcdir}"/carbonio-mariadb.json \
    "${pkgdir}"/etc/grafana/provisioning/dashboards/carbonio-mariadb.json
  install -Dm644 "${srcdir}"/carbonio-node.json \
    "${pkgdir}"/etc/grafana/provisioning/dashboards/carbonio-node.json
  install -Dm644 "${srcdir}"/carbonio-postfix.json \
    "${pkgdir}"/etc/grafana/provisioning/dashboards/carbonio-postfix.json
  install -Dm644 "${srcdir}"/carbonio-process.json \
    "${pkgdir}"/etc/grafana/provisioning/dashboards/carbonio-process.json
  install -Dm644 "${srcdir}"/carbonio.json \
    "${pkgdir}"/etc/grafana/provisioning/dashboards/carbonio.json
  install -Dm644 "${srcdir}"/grafana.ini \
    "${pkgdir}"/etc/grafana/grafana.ini
}

postinst() {
  systemd-sysusers >/dev/null || true
  systemd-tmpfiles --create >/dev/null || true

  echo "Don't forget to reload Grafana"
}
